!function(){function t(t){function e(t,e,n,a,r){var s=d3.sum(t),c=0,i=0,l=n-e-2*a*t.length,u=[];t.forEach(function(c){var o={};o.percent=0==s?0:c/s,o.value=c,o.height=Math.max(o.percent*(n-e-2*a*t.length),r),o.height==r?l-=r:i+=o.height,u.push(o)});var o=l/Math.max(i,1),c=0;return u.forEach(function(i){i.percent=o*i.percent,i.height=i.height==r?r:i.height*o,i.middle=c+a+i.height/2,i.y=e+i.middle-i.percent*(n-e-2*a*t.length)/2,i.h=i.percent*(n-e-2*a*t.length),i.percent=0==s?0:i.value/s,c+=2*a+i.height}),u}var n={};return n.mainBars=[e(t.data[0].map(function(t){return d3.sum(t)}),0,f,y,h),e(t.data[1].map(function(t){return d3.sum(t)}),0,f,y,h)],n.subBars=[[],[]],n.mainBars.forEach(function(a,r){a.forEach(function(a,s){e(t.data[r][s],a.y,a.y+a.h,0,0).forEach(function(t,e){t.key1=0==r?s:e,t.key2=0==r?e:s,n.subBars[r].push(t)})})}),n.subBars.forEach(function(t){t.sort(function(t,e){return t.key1<e.key1?-1:t.key1>e.key1?1:t.key2<e.key2?-1:t.key2>e.key2?1:0})}),n.edges=n.subBars[0].map(function(t,e){return{key1:t.key1,key2:t.key2,y1:t.y,y2:n.subBars[1][e].y,h1:t.h,h2:n.subBars[1][e].h}}),n.keys=t.keys,n}function e(t){var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return s(e(t))}}function n(t,e,n){d3.select("#"+e).append("g").attr("class","part"+n).attr("transform","translate("+n*(d+o)+",0)"),d3.select("#"+e).select(".part"+n).append("g").attr("class","subbars"),d3.select("#"+e).select(".part"+n).append("g").attr("class","mainbars");var a=d3.select("#"+e).select(".part"+n).select(".mainbars").selectAll(".mainbar").data(t.mainBars[n]).enter().append("g").attr("class","mainbar");a.append("rect").attr("class","mainrect").attr("x",0).attr("y",function(t){return t.middle-t.height/2}).attr("width",o).attr("height",function(t){return t.height}).style("shape-rendering","auto").style("fill-opacity",0).style("stroke-width","0.5").style("stroke","black").style("stroke-opacity",0),a.append("text").attr("class","barlabel").attr("x",p[n]).attr("y",function(t){return t.middle+5}).text(function(e,a){return t.keys[n][a]}).attr("text-anchor","start"),a.append("text").attr("class","barvalue").attr("x",m[n]).attr("y",function(t){return t.middle+5}).text(function(t,e){return t.value}).attr("text-anchor","end"),d3.select("#"+e).select(".part"+n).select(".subbars").selectAll(".subbar").data(t.subBars[n]).enter().append("rect").attr("class","subbar").attr("x",0).attr("y",function(t){return t.y}).attr("width",o).attr("height",function(t){return t.h}).style("fill",function(t){return b[t.key1]})}function a(t,e){d3.select("#"+e).append("g").attr("class","edges").attr("transform","translate("+o+",0)"),d3.select("#"+e).select(".edges").selectAll(".edge").data(t.edges).enter().append("polygon").attr("class","edge").attr("points",s).style("fill",function(t){return b[t.key1]}).style("opacity",.5).each(function(t){this._current=t})}function r(t,e){d3.select("#"+e).append("g").attr("class","header").append("text").text(t[2]).style("font-size","20").attr("x",108).attr("y",-20).style("text-anchor","middle").style("font-weight","bold"),[0,1].forEach(function(n){var a=d3.select("#"+e).select(".part"+n).append("g").attr("class","header");a.append("text").text(t[n]).attr("x",p[n]-5).attr("y",-5).style("fill","grey"),a.append("text").text("Votos").attr("x",m[n]-30).attr("y",-5).style("fill","grey"),a.append("line").attr("x1",p[n]-10).attr("y1",-2).attr("x2",g[n]+10).attr("y2",-2).style("stroke","black").style("stroke-width","1").style("shape-rendering","crispEdges")})}function s(t){return[0,t.y1,d,t.y2,d,t.y2+t.h2,0,t.y1+t.h1].join(" ")}function c(t,e,n){var a=d3.select("#"+e).select(".part"+n).select(".mainbars").selectAll(".mainbar").data(t.mainBars[n]);a.select(".mainrect").transition().duration(500).attr("y",function(t){return t.middle-t.height/2}).attr("height",function(t){return t.height}),a.select(".barlabel").transition().duration(500).attr("y",function(t){return t.middle+5}),a.select(".barvalue").transition().duration(500).attr("y",function(t){return t.middle+5}).text(function(t,e){return t.value}),a.select(".barpercent").transition().duration(500).attr("y",function(t){return t.middle+5}).text(function(t,e){return"( "+Math.round(100*t.percent)+"%)"}),d3.select("#"+e).select(".part"+n).select(".subbars").selectAll(".subbar").data(t.subBars[n]).transition().duration(500).attr("y",function(t){return t.y}).attr("height",function(t){return t.h})}function i(t,n){d3.select("#"+n).append("g").attr("class","edges").attr("transform","translate("+o+",0)"),d3.select("#"+n).select(".edges").selectAll(".edge").data(t.edges).transition().duration(500).attrTween("points",e).style("opacity",function(t){return 0==t.h1||0==t.h2?0:.5})}function l(t,e){c(t,e,0),c(t,e,1),i(t,e)}var u={},o=30,d=150,f=600,y=1,h=14,p=[-170,40],m=[-20,170],g=[-10,160],b=new Array(50).join(" ").split("").map(function(){return function(t,e,n){return(n?arguments.callee(t,e,n-1):"#")+e[t.floor(t.random()*e.length)]}(Math,"0123456789ABCDEF",5)});u.partData=function(t,e){var n={};return n.keys=[d3.set(t.map(function(t){return t[0]})).values().reverse(),d3.set(t.map(function(t){return t[1]})).values().sort(function(t,e){return e>t?-1:t>e?1:0})],n.data=[n.keys[0].map(function(t){return n.keys[1].map(function(t){return 0})}),n.keys[1].map(function(t){return n.keys[0].map(function(t){return 0})})],t.forEach(function(t){n.data[0][n.keys[0].indexOf(t[0])][n.keys[1].indexOf(t[1])]=t[e],n.data[1][n.keys[1].indexOf(t[1])][n.keys[0].indexOf(t[0])]=t[e]}),n},u.draw=function(e,s){e.forEach(function(c,i){s.append("g").attr("id",c.id).attr("transform","translate("+550*i+",0)");var l=t(c.data);n(l,c.id,0),n(l,c.id,1),a(l,c.id),r(c.header,c.id),[0,1].forEach(function(t){d3.select("#"+c.id).select(".part"+t).select(".mainbars").selectAll(".mainbar").on("mouseover",function(n,a){return u.selectSegment(e,t,a)}).on("mouseout",function(n,a){return u.deSelectSegment(e,t,a)})})})},u.selectSegment=function(e,n,a){e.forEach(function(e){var r={keys:[],data:[]};r.keys=e.data.keys.map(function(t){return t}),r.data[n]=e.data.data[n].map(function(t){return t}),r.data[1-n]=e.data.data[1-n].map(function(t){return t.map(function(t,e){return a==e?t:0})}),l(t(r),e.id);var s=d3.select("#"+e.id).select(".part"+n).select(".mainbars").selectAll(".mainbar").filter(function(t,e){return e==a});s.select(".mainrect").style("stroke-opacity",1),s.select(".barlabel").style("font-weight","bold"),s.select(".barvalue").style("font-weight","bold"),s.select(".barpercent").style("font-weight","bold")})},u.deSelectSegment=function(e,n,a){e.forEach(function(e){l(t(e.data),e.id);var r=d3.select("#"+e.id).select(".part"+n).select(".mainbars").selectAll(".mainbar").filter(function(t,e){return e==a});r.select(".mainrect").style("stroke-opacity",0),r.select(".barlabel").style("font-weight","normal"),r.select(".barvalue").style("font-weight","normal"),r.select(".barpercent").style("font-weight","normal")})},this.bP=u}();